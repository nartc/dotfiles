set-option -sa terminal-overrides ",xterm*:Tc"
set -g mouse on
# neovim autoread
set -g focus-events on
# allow passthrough for image preview (kitty graphics protocol)
set -g allow-passthrough on
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM

# current pane as window name
set-option -g status-interval 5
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'

# set prefix
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# source
unbind 'r'
bind r source-file ~/.config/tmux/tmux.conf

# Shift Alt HL to cycle througk windows
bind -n M-H previous-window
bind -n M-L next-window

# numbering
set -g base-index 1
set -g pane-base-index 1
set-option -g renumber-windows on

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'niksingh710/minimal-tmux-status'

# stay in copy mode after copying
set -g @yank_action 'copy-pipe'

# set vi mode
set-window-option -g mode-keys vi

# keybindings
bind-key -T copy-mode-vi 'v' send-keys -X begin-selection
bind-key -T copy-mode-vi 'C-v' send-keys -X rectangle-toggle
bind-key -T copy-mode-vi 'C-Y' send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi 'I' send-keys -X back-to-indentation
bind-key -T copy-mode-vi 'A' send-keys -X end-of-line

# tmux-sessionizer keybindings
bind C-o display-popup -E "~/.config/scripts/tmux-sessionizer.sh"
bind C-c run-shell "~/.config/scripts/tmux-sessionizer.sh ~/.config"
bind C-j display-popup -E "tms switch"
bind C-k display-popup -E "~/.config/scripts/tmux-kill-session.sh"
bind C-t display-popup -E "~/.config/scripts/tmux-new-session.sh"
bind C-x display-popup -E "~/.config/scripts/tmux-kill-all-but.sh"

# tms keybindings
# tms doesn't work with my current worktrees workflow
# bind C-o display-popup -E "tms"
# bind C-j display-popup -E "tms switch"
# bind C-w display-popup -E "tms windows"
# bind C-r run-shell "tms refresh"

# prefix d to split pane
unbind %
bind d split-window -h -c "#{pane_current_path}"

# prefix D to split pane vertically
unbind '"'
bind D split-window -v -c "#{pane_current_path}"

# so we don't need vim tmux navigator
bind -r ^ last-window
bind j select-pane -D 
bind k select-pane -U 
bind l select-pane -R 
bind h select-pane -L

# same movement keys to resize panes
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5
bind -r H resize-pane -L 5

# prefix m to max zoom a pane (focus)
bind -r m resize-pane -Z

# prefix t to new tab basically
unbind c
bind t new-window -c "#{pane_current_path}"

# prefix b to toggle status bar
bind-key b set-option status

run '~/.tmux/plugins/tpm/tpm'
